#!/usr/bin/env ruby

require 'rubygems'
require 'amqp'

MQ_HOST = "localhost"
MQ_PORT = 5672
MQ_USER = "guest"
MQ_PASS = "guest"

AMQP.start("amqp://#{MQ_USER}:#{MQ_PASS}@#{MQ_HOST}:#{MQ_PORT}") do |connection|
  Signal.trap('INT') { connection.close { EventMachine.stop } }
  Signal.trap('TERM') { connection.close { EventMachine.stop } }

  channel = AMQP::Channel.new(connection)

  channel.queue("savvy.images", :auto_delete => true).subscribe do |payload|
    puts "Received #{payload}"
  end
end

